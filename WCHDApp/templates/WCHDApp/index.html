{% load static %}
<<<<<<< Updated upstream
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="{% static 'WCHDApp/css/hubStyles.css' %}">
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    
  
</head>
<body>
  <nav class="hubNavbar-top">
    <div class="hubNavbar-left">
      <div id="liveTime">00:00:00 AM</div>
      <div id="liveDate" style="font-size: 15px; margin-top: 2px;"></div>
    </div>
    <div class="hubNavbar-center">
      <label class="switch">
        <input type="checkbox" id="toggleTheme">
        <span class="slider"></span>
      </label>

      <select id="themeSelector" style="margin-left: 10px; padding: 4px 8px; border-radius: 6px;">
        <option value="default">Original Theme</option>
        <option value="blue">Ocean Blue</option>
        <option value="green">Forest Green</option>
        <option value="pink">Sweet Pink</option>
        <option value="purple">Royal Purple</option>
      </select>
    </div>

    </div>
    <div class="hubNavbar-right">
      <span class="cursive-welcome">Welcome, {{ request.user }}</span><br>
      <div style="display: flex; align-items: center; gap: 8px; margin-top: 2px;">
        <p style="font-size: 10px; text-align: left; margin: 0; color: grey;">
          Session time: <span id="sessionTimeValue">{{ duration }}</span>
        </p>
        <button id="toggleSessionTime" style="padding: 2px 6px; font-size: 12px; background-color: transparent; border: none; cursor: pointer;" title="Click to hide your session time">🚫</button>
      </div>
    </div>
  </nav>

  <nav class="hubNavbar-main">
    <ul class="hubNavbar-links"></ul>
    <div class="hubNavbar-action">
      <form id="logout-form" method="POST" action="{% url 'logout' %}" style="display: inline;">
        {% csrf_token %}
        <a href="#" onclick="document.getElementById('logout-form').submit();" class="hubNavbar-link">LOG&nbsp;OUT</a>
      </form>
    </div>
  </nav>

  <div class="logoBox" style="display: flex; justify-content: center; max-height: 250px;">
    <img src="{% static 'WCHDApp/images/logo2.png' %}" alt="logo" style="max-width: 200%; max-height: 250px;">
  </div>

  <div class="container" id="dragBoxContainer">
    <div class="box" data-id="reports" draggable="true"><a href="{% url 'reports' %}">Reports</a></div>
    <div class="box" data-id="table" draggable="true"><a href="{% url 'viewTableSelect' %}">Table View Select</a></div>
    <div class="box" data-id="imports" draggable="true"><a href="{% url 'imports' %}">Imports</a></div>
    <div class="box" data-id="exports" draggable="true"><a href="{% url 'exports' %}">Exports</a></div>
    <div class="box" data-id="transactions" draggable="true"><a href="{% url 'transactionsItem' %}">Transactions</a></div>
    <div class="box" data-id="reconcile" draggable="true"><a href="{% url 'reconcile' %}">Reconcile</a></div>
  </div>

  <div id="colorPalette" class="color-palette" style="display: none;"></div>
  <button id="resetColorsBtn">Reset Colors</button>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const container = document.getElementById('dragBoxContainer');
      const palette = document.getElementById('colorPalette');
      const themeSelector = document.getElementById('themeSelector');
      let targetBox = null;
      let currentTheme = localStorage.getItem('selectedTheme') || 'default'; // Track the current theme

      // Function to set the default box color based on the theme
      function setDefaultBoxColor(theme) {
        switch (theme) {
          case 'blue':
            return '#1976d2'; // Default blue theme box color
          case 'green':
            return '#388e3c'; // Default green theme box color
          case 'pink':
            return '#c2185b'; // Default pink theme box color
          case 'purple':
            return '#512da8'; // Default purple theme box color
          default:
            return '#3498db'; // Default color
        }
      }
=======

{% block title %}{% endblock %}

{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<link rel="stylesheet" type="text/css" href="{% static 'WCHDApp/css/hubStyles.css' %}">

<style>
    body {
        font-family: 'Inter', sans-serif;
    }
    .cursive-welcome {
        font-family: 'Pacifico', cursive;
        font-size: 18px;
        padding: 2px 6px;
        display: inline-block;
    }
    .sortable-ghost {
        opacity: 0.4;
        background: #ccc;
    }
 
    .box {
        transition: transform 0.2s ease-in-out, background-color 0.2s ease-in-out;
    }
</style>


<nav class="hubNavbar-top">
    <div class="hubNavbar-left">
        <div id="liveTime" style="width: 120px; font-family: 'Roboto Mono', monospace; text-align: center;">00:00:00 AM</div>
        <div id="liveDate" style="font-size: 15px; margin-top: 2px;"></div>
    </div>
    <div class="hubNavbar-center">
        <button id="toggleTheme" class="theme-toggle">🌙 Night Mode</button>
    </div>
    <div class="hubNavbar-right">
        <span class="cursive-welcome">Welcome, {{ request.user }}</span><br>
        <div style="display: flex; align-items: center; gap: 8px; margin-top: 2px;">
            <p style="font-size: 10px; text-align: left; margin: 0; color: grey;">
                Session time: <span id="sessionTimeValue">{{ duration }}</span>
            </p>
            <button id="toggleSessionTime"
                    style="padding: 2px 6px; font-size: 12px; background-color: transparent; border: none; cursor: pointer;"
                    title="Click to hide your session time">
                🚫
            </button>
        </div>
    </div>
</nav>

<nav class="hubNavbar-main">
    <ul class="hubNavbar-links"></ul>
    <div class="hubNavbar-action">
        <form id="logout-form" method="POST" action="{% url 'logout' %}" style="display: inline;">
            {% csrf_token %}
            <a href="#" onclick="document.getElementById('logout-form').submit();" class="hubNavbar-link">
                LOG&nbsp;OUT
            </a>
        </form>
    </div>
</nav>

<div class="leftBox">
  <span>This is leftBox</span>
  <div class="verticalLine"></div>
  </div>
  <script>
    const leftBox = document.querySelector('.leftBox');

    window.addEventListener('scroll', () => {
      const scrollPosition = window.scrollY;
      const newTop = Math.max(0, -scrollPosition);

      leftBox.style.top = `${newTop}px`;
    });
  </script>
  
</div>

<div class="logoBox" style="display: flex; justify-content: center; max-height: 250px;">
    <img src="{% static 'WCHDApp/images/logo2.png' %}" alt="logo" style="max-width: 200%; max-height: 250px;">
</div>

<div id="dragBoxContainer" class="container">
    <div class="box" data-id="reports"><a href="{% url 'reports' %}">Reports</a></div>
    <div class="box" data-id="table"><a href="{% url 'viewTableSelect' %}">Table View Select</a></div>
    <div class="box" data-id="imports"><a href="{% url 'imports' %}">Imports</a></div>
    <div class="box" data-id="exports"><a href="{% url 'exports' %}">Exports</a></div>
    <div class="box" data-id="transactions"><a href="{% url 'transactionsItem' %}">Transactions</a></div>
    <div class="box" data-id="reconcile"><a href="{% url 'reconcile' %}">Reconcile</a></div>
    <div class="box" data-id="demo1"><a href="#">Demo x</a></div>
    <div class="box" data-id="demo2"><a href="#">Demo 2</a></div>
    <div class="box" data-id="demo3"><a href="#">Demo 3</a></div>
    <div class="box" data-id="demo4"><a href="#">Demo 4</a></div>
</div>

<button id="resetOrderBtn" style="
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #e74c3c;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 16px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
">
    🔄 Reset Layout
</button>

<script>
document.addEventListener('DOMContentLoaded', function () {
    function updateTime() {
        const now = new Date();
        let hours = now.getHours();
        const minutes = now.getMinutes().toString().padStart(2, '0');
        const seconds = now.getSeconds().toString().padStart(2, '0');
        const ampm = hours >= 12 ? 'PM' : 'AM';
        hours = hours % 12 || 12;
        document.getElementById('liveTime').innerText = `${hours}:${minutes}:${seconds} ${ampm}`;
    }

    function updateDate() {
        const now = new Date();
        const month = (now.getMonth() + 1).toString().padStart(2, '0');
        const day = now.getDate().toString().padStart(2, '0');
        const year = now.getFullYear();
        document.getElementById('liveDate').innerText = `${month}/${day}/${year}`;
    }

    const now = new Date();
    const todayKey = now.toDateString();
    if (localStorage.getItem('loginDate') !== todayKey) {
        localStorage.setItem('loginDate', todayKey);
        localStorage.setItem('loginTime', Date.now());
    }

    const startTime = parseInt(localStorage.getItem('loginTime'), 10);

    function updateSessionTime() {
        const now = Date.now();
        const diff = now - startTime;
        const hours = Math.floor(diff / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
        document.getElementById('sessionTimeValue').innerText = `${hours}h ${minutes}m ${seconds}s`;
    }
>>>>>>> Stashed changes

      // Load saved box colors
      const savedColors = JSON.parse(localStorage.getItem('boxColors') || '{}');
      [...container.children].forEach(box => {
        const id = box.dataset.id;
        if (savedColors[id]) {
          box.style.backgroundColor = savedColors[id];
        } else if (currentTheme !== 'default') {
          box.style.backgroundColor = setDefaultBoxColor(currentTheme);
        }
      });

      // Initialize SortableJS for drag and drop
      Sortable.create(container, {
        animation: 150,
        onEnd: () => {
          const order = Array.from(container.children).map(el => el.dataset.id);
          localStorage.setItem('dashboardOrder', JSON.stringify(order));
        }
      });

<<<<<<< Updated upstream
      // Build color palette
      const presetColors = ['#ff69b4', '#3498db', '#e74c3c', '#2ecc71', '#f1c40f', '#9b59b6', '#1abc9c', '#34495e'];

      function buildPalette(x, y) {
        palette.innerHTML = '';
        const section = document.createElement('div');
        section.className = 'color-section';
=======
    if (localStorage.getItem('theme') === 'dark') {
        body.classList.add('dark-mode');
        toggleThemeBtn.textContent = '☀️ Day Mode';
    }

    toggleThemeBtn.addEventListener('click', () => {
        body.classList.toggle('dark-mode');
        const isDark = body.classList.contains('dark-mode');
        toggleThemeBtn.textContent = isDark ? '☀️ Day Mode' : '🌙 Night Mode';
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });
>>>>>>> Stashed changes

        presetColors.forEach(color => {
          const div = document.createElement('div');
          div.className = 'color-option';
          div.style.backgroundColor = color;
          div.dataset.color = color;
          section.appendChild(div);
        });

<<<<<<< Updated upstream
        const customColor = document.createElement('input');
        customColor.type = 'color';
        customColor.id = 'customColorInput';

        customColor.addEventListener('input', () => {
          applyColor(customColor.value);
        });

        section.appendChild(customColor);

        palette.appendChild(section);
        palette.style.left = `${x}px`;
        palette.style.top = `${y}px`;
        palette.style.display = 'flex';
      }

      function applyColor(color) {
        if (!targetBox) return;
        targetBox.style.backgroundColor = color;
        const id = targetBox.dataset.id;
        const saved = JSON.parse(localStorage.getItem('boxColors') || '{}');
        saved[id] = color;
        localStorage.setItem('boxColors', JSON.stringify(saved));
        palette.style.display = 'none';
        targetBox = null;
      }

      // Context menu for color palette
      container.addEventListener('contextmenu', function (e) {
        const box = e.target.closest('.box');
        if (!box) return;
        e.preventDefault();
        targetBox = box;
        buildPalette(e.pageX, e.pageY);
      });

      palette.addEventListener('click', function (e) {
        if (e.target.classList.contains('color-option')) {
          applyColor(e.target.dataset.color);
        }
      });

      document.addEventListener('click', function (e) {
        if (!palette.contains(e.target)) {
          palette.style.display = 'none';
          targetBox = null;
        }
      });

      // Reset box colors to the default of the current theme
      document.getElementById('resetColorsBtn').addEventListener('click', () => {
        localStorage.removeItem('boxColors');
        [...container.children].forEach(box => {
          box.style.backgroundColor = setDefaultBoxColor(currentTheme);
        });
      });

      // Live time and date updates
      function updateTime() {
        const now = new Date();
        let hours = now.getHours();
        const minutes = now.getMinutes().toString().padStart(2, '0');
        const seconds = now.getSeconds().toString().padStart(2, '0');
        const ampm = hours >= 12 ? 'PM' : 'AM';
        hours = hours % 12 || 12;
        document.getElementById('liveTime').innerText = `${hours}:${minutes}:${seconds} ${ampm}`;
      }

      function updateDate() {
        const now = new Date();
        const month = (now.getMonth() + 1).toString().padStart(2, '0');
        const day = now.getDate().toString().padStart(2, '0');
        const year = now.getFullYear();
        document.getElementById('liveDate').innerText = `${month}/${day}/${year}`;
      }

      // Session time tracking
      if (localStorage.getItem('loginDate') !== new Date().toDateString()) {
        localStorage.setItem('loginDate', new Date().toDateString());
        localStorage.setItem('loginTime', Date.now());
      }

      const startTime = parseInt(localStorage.getItem('loginTime'), 10);
      function updateSessionTime() {
        const now = Date.now();
        const diff = now - startTime;
        const h = Math.floor(diff / 3600000);
        const m = Math.floor((diff % 3600000) / 60000);
        const s = Math.floor((diff % 60000) / 1000);
        document.getElementById('sessionTimeValue').innerText = `${h}h ${m}m ${s}s`;
      }

      setInterval(updateTime, 1000);
      setInterval(updateSessionTime, 1000);
      updateTime();
      updateDate();
      updateSessionTime();

      // Dark mode toggle
      const toggleThemeCheckbox = document.getElementById('toggleTheme');
      if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-mode');
        toggleThemeCheckbox.checked = true;
      }
      toggleThemeCheckbox.addEventListener('change', () => {
        document.body.classList.toggle('dark-mode');
        const dark = document.body.classList.contains('dark-mode');
        localStorage.setItem('theme', dark ? 'dark' : 'light');
      });

      // Toggle session time visibility
      const toggleSessionBtn = document.getElementById('toggleSessionTime');
      const sessionValue = document.getElementById('sessionTimeValue');
      toggleSessionBtn.addEventListener('click', () => {
        const hidden = sessionValue.style.display === 'none';
        sessionValue.style.display = hidden ? 'inline' : 'none';
        toggleSessionBtn.textContent = hidden ? '🚫' : '👁️';
        toggleSessionBtn.title = hidden ? 'Click to hide your session time' : 'Click to show your session time';
      });

      // Theme selector functionality
      themeSelector.addEventListener('change', function() {
        const selectedTheme = this.value;
        document.body.classList.remove('blue-theme', 'green-theme', 'pink-theme', 'purple-theme'); // Remove existing theme classes
        if (selectedTheme !== 'default') {
          document.body.classList.add(`${selectedTheme}-theme`);
          localStorage.setItem('selectedTheme', selectedTheme); // Save selected theme
          currentTheme = selectedTheme; // Update current theme
          // Set default box colors for the new theme
          [...container.children].forEach(box => {
            if (!localStorage.getItem('boxColors')?.includes(box.dataset.id)) {
              box.style.backgroundColor = setDefaultBoxColor(selectedTheme);
            }
          });
        } else {
          localStorage.removeItem('selectedTheme'); // Remove saved theme if default is selected
          currentTheme = 'default';
          // Reset box colors to the original default
          [...container.children].forEach(box => {
            if (!localStorage.getItem('boxColors')?.includes(box.dataset.id)) {
              box.style.backgroundColor = '#3498db';
            }
          });
        }
      });

      // Load saved theme on page load
      const savedTheme = localStorage.getItem('selectedTheme');
      if (savedTheme) {
        document.body.classList.add(`${savedTheme}-theme`);
        themeSelector.value = savedTheme;
        currentTheme = savedTheme;
        // Set default box colors on load if no custom color is saved
        [...container.children].forEach(box => {
          if (!localStorage.getItem('boxColors')?.includes(box.dataset.id)) {
            box.style.backgroundColor = setDefaultBoxColor(savedTheme);
          }
        });
      }
    });
  </script>
</body>
</html>
=======
    toggleSessionBtn.addEventListener('click', () => {
        const isHidden = sessionValue.style.display === 'none';
        sessionValue.style.display = isHidden ? 'inline' : 'none';
        toggleSessionBtn.title = isHidden ? 'Click to hide your session time' : 'Click to show your session time';
        toggleSessionBtn.textContent = isHidden ? '🚫' : '👁️';
    });

    const dragContainer = document.getElementById('dragBoxContainer');
    let sortableInstance;

    function saveOrder() {
        const order = Array.from(dragContainer.children).map(box => box.dataset.id);
        localStorage.setItem('boxOrder', JSON.stringify(order));
    }

    function loadOrder() {
        const savedOrder = JSON.parse(localStorage.getItem('boxOrder'));
        if (savedOrder) {
            const boxMap = {};
            Array.from(dragContainer.children).forEach(box => {
                boxMap[box.dataset.id] = box;
            });
            dragContainer.innerHTML = '';
            savedOrder.forEach(id => {
                if (boxMap[id]) {
                    dragContainer.appendChild(boxMap[id]);
                }
            });
        }
        if (!sortableInstance) {
            sortableInstance = new Sortable(dragContainer, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                onEnd: saveOrder
            });
        }
    }

    loadOrder();

    const resetBtn = document.getElementById('resetOrderBtn');
    resetBtn.addEventListener('click', () => {
        const boxes = Array.from(dragContainer.children);
        boxes.forEach((box, index) => {
            setTimeout(() => {
                box.style.transform = 'translateY(-10px)';
                box.style.backgroundColor = '#ddd';
            }, index * 50);
            setTimeout(() => {
                box.style.transform = 'translateY(0)';
                box.style.backgroundColor = '';
            }, 200 + index * 50);
        });

        setTimeout(() => {
            localStorage.removeItem('boxOrder');
            location.reload();
        }, 500);
    });
});
</script>
{% endblock %}
>>>>>>> Stashed changes
